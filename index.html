<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ultimate Ideation Tool</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --color-primary: #4f46e5;
        --color-primary-dark: #4338ca;
        --color-secondary: #f97316;
        --color-accent: #8b5cf6;
        --color-light: #f3f4f6;
        --color-dark: #1f2937;
      }

      .sticky-note {
        @apply bg-yellow-100 shadow-md rounded-md p-3 mb-2 transition-all duration-300;
      }

      .sticky-note:hover {
        @apply shadow-lg transform -translate-y-1;
      }

      .sticky-note-work {
        @apply bg-blue-100;
      }

      .sticky-note-relationships {
        @apply bg-pink-100;
      }

      .sticky-note-health {
        @apply bg-green-100;
      }

      .sticky-note-play {
        @apply bg-purple-100;
      }

      .dragging {
        @apply opacity-50 shadow-xl;
      }
    </style>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
      }

      .form-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border-radius: 10px;
        background-color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .section-header {
        background: linear-gradient(to right, #4f46e5, #8b5cf6);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .progress-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
      }

      .progress-step {
        flex: 1;
        text-align: center;
        position: relative;
      }

      .progress-step::after {
        content: "";
        height: 2px;
        background-color: #e5e7eb;
        position: absolute;
        top: 15px;
        left: 50%;
        right: -50%;
        z-index: 0;
      }

      .progress-step:last-child::after {
        display: none;
      }

      .progress-step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e5e7eb;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
        margin-bottom: 0.5rem;
        transition: background-color 0.3s ease;
      }

      .progress-step.active .progress-step-number {
        background-color: #4f46e5;
        color: white;
      }

      .progress-step.completed .progress-step-number {
        background-color: #10b981;
        color: white;
      }

      .tag-input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 0.25rem;
        min-height: 100px;
      }

      .tag {
        background-color: #4f46e5;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        display: inline-flex;
        align-items: center;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .tag-remove {
        margin-left: 0.5rem;
        cursor: pointer;
      }

      .brainstorm-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }

      .brainstorm-column {
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        min-height: 300px;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }

      .loading-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #4f46e5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #10b981;
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transform: translateX(200%);
        transition: transform 0.3s ease-out;
      }

      .success-message.show {
        transform: translateX(0);
      }

      .btn-primary {
        background-color: #4f46e5;
        border-color: #4f46e5;
      }

      .btn-primary:hover {
        background-color: #4338ca;
        border-color: #4338ca;
      }

      .btn-secondary {
        background-color: #f97316;
        border-color: #f97316;
      }

      .btn-secondary:hover {
        background-color: #ea580c;
        border-color: #ea580c;
      }

      .next-steps-card {
        background-color: #f8fafc;
        border-left: 4px solid #4f46e5;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 0.25rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .skill-level {
        display: flex;
        align-items: center;
        margin-top: 0.5rem;
      }

      .skill-level-circle {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #e5e7eb;
        margin-right: 0.25rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .skill-level-circle.filled {
        background-color: #4f46e5;
      }

      /* Timer styles */
      .timer-container {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .timer-display {
        font-size: 2rem;
        font-weight: bold;
        font-family: monospace;
        color: white;
      }

      .note-counter,
      .high-score {
        font-size: 1.2rem;
        color: white;
      }

      .timer-container.active {
        animation: pulse 2s infinite;
      }

      .timer-container.ending {
        animation: pulse-warning 1s infinite;
      }

      @keyframes pulse {
        0% {
          background-color: rgba(255, 255, 255, 0.1);
        }
        50% {
          background-color: rgba(255, 255, 255, 0.2);
        }
        100% {
          background-color: rgba(255, 255, 255, 0.1);
        }
      }

      @keyframes pulse-warning {
        0% {
          background-color: rgba(255, 87, 34, 0.1);
        }
        50% {
          background-color: rgba(255, 87, 34, 0.2);
        }
        100% {
          background-color: rgba(255, 87, 34, 0.1);
        }
      }

      /* Mobile optimizations */
      @media (max-width: 768px) {
        .brainstorm-container {
          grid-template-columns: 1fr;
        }

        .progress-step-text {
          font-size: 0.75rem;
        }
      }

      .solution-card {
        transition: transform 0.2s ease-in-out;
      }

      .solution-card:hover {
        transform: translateY(-5px);
      }

      .solution-card .card-title {
        color: #4f46e5;
      }

      .prd-section h6 {
        font-weight: 600;
      }

      .prd-section ul li {
        margin-bottom: 0.5rem;
      }

      #prd-content {
        font-size: 0.95rem;
      }

      .prd-content.editing .prd-section {
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .prd-content.editing .prd-section:focus-within {
        border-color: #4f46e5;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
      }

      .prd-content.editing [contenteditable] {
        outline: none;
        padding: 0.25rem;
        border-radius: 0.25rem;
      }

      .prd-content.editing [contenteditable]:hover {
        background-color: rgba(79, 70, 229, 0.05);
      }

      .prd-content.editing [contenteditable]:focus {
        background-color: rgba(79, 70, 229, 0.1);
      }

      .progress {
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
      }
      .progress-bar {
        background-color: #4f46e5;
        border-radius: 10px;
      }
      .metric-item label {
        margin-bottom: 5px;
        font-weight: 500;
      }
      .growth-area-card {
        border-left: 4px solid #4f46e5;
        margin-bottom: 1rem;
      }
      .recommendation-card {
        border-left: 4px solid #f97316;
        margin-bottom: 1rem;
      }
      .priority-high {
        color: #dc2626;
      }
      .priority-medium {
        color: #f97316;
      }
      .priority-low {
        color: #10b981;
      }
      .project-card {
        transition: transform 0.2s ease-in-out;
        position: relative;
      }
      .project-card:hover {
        transform: translateY(-5px);
      }
      .project-card.saved {
        border-color: #4f46e5;
      }
      .pin-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1;
      }
      .pin-btn.pinned {
        color: #4f46e5;
      }
      .mentor-section {
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        margin-top: 1rem;
        padding-top: 1rem;
      }
      .mentor-image {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
      }
      .mentor-bio {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
      }
      .mentor-header {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .mentor-name {
        font-weight: 600;
        color: #4f46e5;
        margin: 0;
      }
      .progress-step.clickable {
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .progress-step.clickable:hover {
        transform: translateY(-2px);
      }

      .progress-step.clickable:not(.active) {
        opacity: 0.7;
      }

      .progress-step.clickable:not(.active):hover {
        opacity: 1;
      }

      /* PRD Styles */
      .prd-section {
        margin-bottom: 1rem;
      }

      .prd-section .card-title {
        color: #4f46e5;
        font-weight: 600;
      }

      .prd-editable {
        padding: 0.5rem;
        border-radius: 0.25rem;
        transition: background-color 0.2s;
      }

      .prd-editable[contenteditable="true"] {
        background-color: rgba(79, 70, 229, 0.05);
        outline: none;
      }

      .prd-editable[contenteditable="true"]:focus {
        background-color: rgba(79, 70, 229, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <header class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary mb-3">
          Ultimate Ideation Tool
        </h1>
        <p class="lead">
          Your companion for finding the perfect project idea based on your
          skills, interests, and goals
        </p>
      </header>

      <div class="progress-indicator mb-4">
        <div
          class="progress-step active clickable"
          id="step1"
          data-section="personal-info-section"
        >
          <div class="progress-step-number">1</div>
          <div class="progress-step-text">Personal Info</div>
        </div>
        <div
          class="progress-step clickable"
          id="step2"
          data-section="skills-section"
        >
          <div class="progress-step-number">2</div>
          <div class="progress-step-text">Skills & Projects</div>
        </div>
        <div
          class="progress-step clickable"
          id="step3"
          data-section="edge-analysis-section"
        >
          <div class="progress-step-number">3</div>
          <div class="progress-step-text">Edge Analysis</div>
        </div>
        <div
          class="progress-step clickable"
          id="step4"
          data-section="project-generation-section"
        >
          <div class="progress-step-number">4</div>
          <div class="progress-step-text">Project Generation</div>
        </div>
        <div
          class="progress-step clickable"
          id="step5"
          data-section="future-plans-section"
        >
          <div class="progress-step-number">5</div>
          <div class="progress-step-text">Future Plans</div>
        </div>
      </div>

      <!-- Step 1: Personal Information -->
      <section id="personal-info-section" class="form-section">
        <div class="section-header">
          <h2><i class="fas fa-user me-2"></i>Personal Information</h2>
          <p>
            Tell us a bit about yourself to help personalize your experience.
          </p>
        </div>

        <form id="personal-info-form">
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label for="name" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                placeholder="Your name"
              />
            </div>
            <div class="col-md-3">
              <label for="age" class="form-label">Age</label>
              <input
                type="number"
                class="form-control"
                id="age"
                min="13"
                max="100"
              />
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label">Interests & Hobbies</label>
            <p class="text-muted small">
              Type and press Enter to add multiple interests
            </p>
            <div class="tag-input-container" id="interests-container">
              <input
                type="text"
                class="form-control tag-input"
                id="interests-input"
                placeholder="Technology, reading, hiking, etc."
              />
            </div>
          </div>

          <div class="d-flex justify-content-end">
            <button
              type="button"
              class="btn btn-primary px-4"
              id="next-to-skills"
            >
              Next: Skills & Projects <i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </form>
      </section>

      <!-- Step 2: Skills & Projects -->
      <section id="skills-section" class="form-section" style="display: none">
        <div class="section-header">
          <h2><i class="fas fa-code me-2"></i>Skills & Projects</h2>
          <p>Tell us about your technical skills and past projects.</p>
        </div>

        <div class="mb-4">
          <h5>Current Skills</h5>
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control"
              id="skill-input"
              placeholder="Enter a skill (e.g., Python, JavaScript, React)"
            />
            <button
              class="btn btn-outline-primary"
              type="button"
              id="add-skill-btn"
            >
              Add Skill
            </button>
          </div>
          <div id="skills-list"></div>
        </div>

        <div class="mb-4">
          <h5>Skills I Want to Learn</h5>
          <p class="text-muted small">
            Type and press Enter to add multiple skills
          </p>
          <div class="tag-input-container" id="skills-to-learn-container">
            <input
              type="text"
              class="form-control tag-input"
              id="skills-to-learn-input"
              placeholder="Skills you want to learn"
            />
          </div>
        </div>

        <div class="mb-4">
          <h5>Projects & Achievements</h5>
          <p class="text-muted small">
            Add projects you've worked on or achievements you're proud of
          </p>
          <div id="projects-list">
            <div class="mb-3">
              <textarea
                class="form-control mb-2 project-description"
                rows="2"
                placeholder="Describe a project or achievement"
              ></textarea>
              <button
                type="button"
                class="btn btn-sm btn-outline-danger remove-project"
              >
                Remove
              </button>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-outline-primary"
            id="add-project-btn"
          >
            <i class="fas fa-plus me-2"></i>Add Another Project
          </button>
        </div>

        <div class="d-flex justify-content-between">
          <button
            type="button"
            class="btn btn-secondary px-4"
            id="back-to-personal"
          >
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button
            type="button"
            class="btn btn-primary px-4"
            id="analyze-edge-btn"
          >
            Next: Edge Analysis <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </section>

      <!-- Step 3: Edge Analysis -->
      <section
        id="edge-analysis-section"
        class="form-section"
        style="display: none"
      >
        <div class="section-header">
          <h2><i class="fas fa-chart-bar me-2"></i>Edge Analysis</h2>
          <p>Analysis of your skills, strengths, and growth opportunities</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Skills Radar</h5>
                <canvas id="skills-radar-chart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Summary</h5>
                <p id="analysis-summary" class="card-text"></p>
                <div
                  id="strengths-list"
                  class="list-group list-group-flush mt-3"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Growth Areas</h5>
                <div id="growth-areas-container"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Recommendations</h5>
            <div id="recommendations-container"></div>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary px-4"
            id="back-to-skills-from-edge"
          >
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button
            type="button"
            class="btn btn-primary px-4"
            id="next-to-project-generation"
          >
            Project Generation <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </section>

      <!-- Step 4: Project Generation -->
      <section
        id="project-generation-section"
        class="form-section"
        style="display: none"
      >
        <div class="section-header">
          <h2><i class="fas fa-lightbulb me-2"></i>Project Ideas Generator</h2>
          <p>Generate project ideas based on your interests and strengths</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-heart me-2"></i>Your Interests
                </h5>
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    id="new-interest-input"
                    placeholder="Add new interest"
                  />
                  <button
                    class="btn btn-outline-primary"
                    type="button"
                    id="add-new-interest-btn"
                  >
                    <i class="fas fa-plus"></i> Add
                  </button>
                </div>
                <div id="interests-checkboxes" class="mb-3">
                  <!-- Interests will be populated here -->
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-star me-2"></i>Your Strengths
                </h5>
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    id="new-strength-input"
                    placeholder="Add new strength"
                  />
                  <button
                    class="btn btn-outline-primary"
                    type="button"
                    id="add-new-strength-btn"
                  >
                    <i class="fas fa-plus"></i> Add
                  </button>
                </div>
                <div id="strengths-checkboxes" class="mb-3">
                  <!-- Strengths will be populated here -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-lightbulb me-2"></i>Interesting Problems
                </h5>
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    id="new-problem-input"
                    placeholder="Add observed problem"
                  />
                  <button
                    class="btn btn-outline-primary"
                    type="button"
                    id="add-new-problem-btn"
                  >
                    <i class="fas fa-plus"></i> Add
                  </button>
                </div>
                <div id="problems-list" class="mb-3">
                  <!-- Problems will be populated here -->
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-bullseye me-2"></i>Project Goal
                </h5>
                <div class="form-group">
                  <select class="form-select" id="project-goal">
                    <option value="" disabled>Select your project goal</option>
                    <option value="ai_research">AI Research Project</option>
                    <option value="ai_entrepreneurship">
                      AI Entrepreneurship Project
                    </option>
                    <option value="social_impact">
                      AI Social Impact Project
                    </option>
                  </select>
                  <div class="mt-3">
                    <p class="text-muted" id="goal-description"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center mb-4">
          <button
            type="button"
            class="btn btn-primary btn-lg"
            id="generate-projects-btn"
          >
            <i class="fas fa-magic me-2"></i>Generate Project Ideas
          </button>
        </div>

        <!-- How Might We Statement -->
        <div id="how-might-we-section" class="mb-4" style="display: none">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-question-circle me-2"></i>Challenge Statement
              </h5>
              <p class="card-text" id="how-might-we-text"></p>
            </div>
          </div>
        </div>

        <div class="row" id="project-ideas-container">
          <!-- Project ideas will be displayed here -->
        </div>

        <div id="saved-projects-section" class="mt-4">
          <h5 class="mb-3">
            <i class="fas fa-thumbtack me-2"></i>Saved Projects
          </h5>
          <div class="row" id="saved-projects-container">
            <!-- Saved projects will be displayed here -->
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary px-4"
            id="back-to-edge-analysis"
          >
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button
            type="button"
            class="btn btn-primary px-4"
            id="next-to-future-plans"
          >
            Future Plans <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </section>

      <!-- Step 5: Future Plans -->
      <section
        id="future-plans-section"
        class="form-section"
        style="display: none"
      >
        <div class="section-header">
          <h2><i class="fas fa-calendar-alt me-2"></i>Future Plans</h2>
          <p>Generate a detailed 10-week plan for your selected project</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Select a Project</h5>
                <div id="saved-prds-list" class="list-group mb-4">
                  <!-- Saved PRDs will be listed here -->
                </div>
                <div id="selected-prd-details" style="display: none">
                  <h5 class="mb-3">Selected Project Details</h5>
                  <div class="card bg-light">
                    <div class="card-body">
                      <h6 id="selected-prd-title" class="card-title"></h6>
                      <p id="selected-prd-description" class="card-text"></p>
                    </div>
                  </div>
                  <button class="btn btn-primary mt-3" id="generate-plan-btn">
                    <i class="fas fa-calendar-plus me-2"></i>Generate 10-Week
                    Plan
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="plan-result" style="display: none">
          <div class="card mb-4">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-4"
              >
                <h5 class="card-title mb-0">
                  <i class="fas fa-tasks me-2"></i>10-Week Development Plan
                </h5>
                <button
                  class="btn btn-outline-primary btn-sm"
                  id="save-plan-btn"
                >
                  <i class="fas fa-save me-1"></i>Save Plan
                </button>
              </div>
              <div id="week-plan-container">
                <!-- Week plans will be displayed here -->
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary px-4"
            id="back-to-projects-from-plans"
          >
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
        </div>
      </section>

      <style>
        .week-card {
          border-left: 4px solid #4f46e5;
          margin-bottom: 1rem;
          transition: transform 0.2s;
        }
        .week-card:hover {
          transform: translateY(-2px);
        }
        .step-list {
          list-style-type: none;
          padding-left: 0;
        }
        .step-list li {
          margin-bottom: 0.5rem;
          padding-left: 1.5rem;
          position: relative;
        }
        .step-list li:before {
          content: "â†’";
          position: absolute;
          left: 0;
          color: #4f46e5;
        }
        .milestone-badge {
          background-color: #4f46e5;
          color: white;
          padding: 0.5rem 1rem;
          border-radius: 1rem;
          font-size: 0.9rem;
          margin-top: 1rem;
        }
      </style>

      <!-- PRD Modal -->
      <div class="modal fade" id="prd-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">
                Generate Project Requirements Document
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Selected Idea</label>
                <input type="text" class="form-control" id="prd-idea-title" />
                <div class="mt-2">
                  <label class="form-label">Idea Description</label>
                  <textarea
                    class="form-control"
                    id="prd-idea-description"
                    rows="3"
                  ></textarea>
                </div>
              </div>
              <div class="mb-3">
                <label for="prd-conversation" class="form-label"
                  >Additional Context/Notes</label
                >
                <textarea
                  class="form-control"
                  id="prd-conversation"
                  rows="5"
                  placeholder="Add any additional context, meeting notes, or requirements here..."
                ></textarea>
              </div>
              <div id="prd-result" class="mt-4" style="display: none">
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <div class="d-flex align-items-center">
                    <h6 class="mb-0">Generated PRD</h6>
                    <i
                      class="fas fa-info-circle ms-2 text-primary"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-html="true"
                      title="A Project Requirements Document (PRD) is a detailed description of a project's purpose, features, functionality, and behavior."
                    ></i>
                  </div>
                  <div class="btn-group">
                    <button
                      class="btn btn-outline-secondary btn-sm"
                      id="edit-prd-btn"
                    >
                      <i class="fas fa-edit me-1"></i> Edit
                    </button>
                    <button
                      class="btn btn-outline-primary btn-sm"
                      id="copy-prd-btn"
                    >
                      <i class="fas fa-copy me-1"></i> Copy
                    </button>
                  </div>
                </div>
                <div class="card">
                  <div class="card-body">
                    <div id="prd-content" class="prd-content">
                      <!-- PRD content will be inserted here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="generate-prd-btn"
              >
                Generate PRD <i class="fas fa-file-alt ms-2"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loading-overlay">
        <div class="spinner mb-3"></div>
        <h4 id="loading-text">Processing your information...</h4>
      </div>

      <!-- Success Message -->
      <div class="success-message" id="success-message">
        <i class="fas fa-check-circle me-2"></i>
        <span id="success-text">Content copied to clipboard!</span>
      </div>

      <!-- Restart Modal -->
      <div
        class="modal fade"
        id="restart-modal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Start Over?</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p>
                Would you like to start the process over with a fresh worksheet?
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                No, Keep Working
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="confirm-restart"
              >
                Yes, Start Over
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        // Initialize variables
        let userData = {
          personalInfo: {},
          skills: [],
          skillsToLearn: [],
          projects: [],
          edgeAnalysisResult: {},
          projectGenerationData: {
            selectedInterests: [],
            selectedStrengths: [],
            generatedIdeas: [],
            observedProblems: [],
            projectGoal: "",
          },
          generatedPRDs: {},
          projectPlans: {}, // Add storage for project plans
        };

        // Initialize localStorage if needed
        if (localStorage.getItem("edgeAnalysisData")) {
          try {
            userData = JSON.parse(localStorage.getItem("edgeAnalysisData"));
            loadSavedData();

            // If edge analysis data exists, display it
            if (
              userData.edgeAnalysisResult &&
              Object.keys(userData.edgeAnalysisResult).length > 0
            ) {
              displayEdgeAnalysisResults(userData.edgeAnalysisResult);
            }

            // If project generation data exists, display it
            if (
              userData.projectGenerationData &&
              userData.projectGenerationData.generatedIdeas.length > 0
            ) {
              displayProjectIdeas(
                userData.projectGenerationData.generatedIdeas
              );
            }
          } catch (e) {
            console.error("Error loading saved data:", e);
          }
        }

        // Set up Bootstrap components
        const restartModal = new bootstrap.Modal(
          document.getElementById("restart-modal")
        );

        // Add click handlers for progress steps
        $(".progress-step.clickable").click(function () {
          const targetSection = $(this).data("section");
          const stepNumber = parseInt($(this).attr("id").replace("step", ""));

          // Don't allow skipping to edge analysis or project generation without data
          if (stepNumber === 3 && !userData.skills.length) {
            alert("Please complete your skills and projects first.");
            return;
          }
          if (stepNumber === 4 && !userData.edgeAnalysisResult?.strengths) {
            alert("Please complete the edge analysis first.");
            return;
          }

          // Hide all sections
          $(".form-section").hide();

          // Show target section
          $(`#${targetSection}`).show();

          // Update progress indicator
          updateProgressIndicator(stepNumber);

          // Save data when moving between sections
          if (stepNumber > 1) {
            savePersonalInfo();
          }
          if (stepNumber > 2) {
            saveSkillsAndProjects();
          }

          // If moving to project generation, ensure interests and strengths are populated
          if (stepNumber === 4) {
            populateInterestsAndStrengths();
          }

          // If moving to future plans, load saved PRDs
          if (stepNumber === 5) {
            loadSavedPRDs();
          }
        });

        // Add click handler for back-to-personal button
        $("#back-to-personal").click(function () {
          saveSkillsAndProjects();
          $("#skills-section").hide();
          $("#personal-info-section").show();
          updateProgressIndicator(1);
        });

        // Add click handler for back-to-edge-analysis button
        $("#back-to-edge-analysis").click(function () {
          $("#project-generation-section").hide();
          $("#edge-analysis-section").show();
          updateProgressIndicator(3);
        });

        // Update progress indicator
        function updateProgressIndicator(step) {
          $(".progress-step").removeClass("active completed");
          for (let i = 1; i < step; i++) {
            $(`#step${i}`).addClass("completed");
          }
          $(`#step${step}`).addClass("active");
        }

        // Handle tags input (for interests and skills to learn)
        $(".tag-input").keydown(function (e) {
          if (e.key === "Enter" && $(this).val().trim() !== "") {
            e.preventDefault();
            const inputId = $(this).attr("id");
            const containerId = inputId.replace("-input", "-container");
            const tagText = $(this).val().trim();

            addTag(containerId, tagText);
            $(this).val("");
          }
        });

        function addTag(containerId, text) {
          const tag = $(`
            <div class="tag">
              ${text}
              <span class="tag-remove"><i class="fas fa-times"></i></span>
            </div>
          `);

          tag.find(".tag-remove").click(function () {
            $(this).parent().remove();
          });

          $(`#${containerId}`).append(tag);
        }

        // Skills section
        $("#add-skill-btn").click(function () {
          const skillName = $("#skill-input").val().trim();
          if (skillName) {
            addSkill(skillName);
            $("#skill-input").val("").focus();
          }
        });

        function addSkill(skillName) {
          const skillElement = $(`
            <div class="card mb-2 skill-card">
              <div class="card-body py-2">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="skill-name">${skillName}</span>
                  <button type="button" class="btn-close remove-skill" aria-label="Remove"></button>
                </div>
                <div class="skill-level" data-skill="${skillName}">
                    <span class="ms-2 text-muted small">Beginner</span>
                  <div class="skill-level-circle" data-level="1"></div>
                  <div class="skill-level-circle" data-level="2"></div>
                  <div class="skill-level-circle" data-level="3"></div>
                  <div class="skill-level-circle" data-level="4"></div>
                  <div class="skill-level-circle" data-level="5"></div>
                  <span class="ms-2 text-muted small">Expert</span>
                </div>
              </div>
            </div>
          `);

          skillElement.find(".remove-skill").click(function () {
            $(this).closest(".skill-card").remove();
          });

          skillElement.find(".skill-level-circle").click(function () {
            const level = $(this).data("level");
            const skillName = $(this).parent().data("skill");

            // Reset all circles
            $(this).parent().find(".skill-level-circle").removeClass("filled");

            // Fill circles up to the selected level
            $(this)
              .parent()
              .find(".skill-level-circle")
              .each(function () {
                if ($(this).data("level") <= level) {
                  $(this).addClass("filled");
                }
              });

            // Update skill in userData
            const skillIndex = userData.skills.findIndex(
              (s) => s.name === skillName
            );
            if (skillIndex !== -1) {
              userData.skills[skillIndex].level = level;
            } else {
              userData.skills.push({ name: skillName, level: level });
            }
            saveToLocalStorage();
          });

          $("#skills-list").append(skillElement);
        }

        // Project section
        $("#add-project-btn").click(function () {
          addProject("");
        });

        function addProject(description) {
          const projectElement = $(`
            <div class="mb-3">
              <textarea class="form-control mb-2 project-description" rows="2" placeholder="Describe a project or achievement">${description}</textarea>
              <button type="button" class="btn btn-sm btn-outline-danger remove-project">Remove</button>
            </div>
          `);

          projectElement.find(".remove-project").click(function () {
            $(this).closest(".mb-3").remove();
          });

          $("#projects-list").append(projectElement);
        }

        // Edge Analysis
        $("#analyze-edge-btn").click(async function () {
          saveSkillsAndProjects();
          showLoading("Analyzing your edge...");

          try {
            const edgePayload = {
              studentName: $("#name").val() || "Anonymous Student",
              name: $("#name").val() || "Anonymous Student",
              age: $("#age").val() || "",
              interests: userData.personalInfo.interests || [],
              skills:
                userData.skills.map((skill) => ({
                  name: skill.name,
                  proficiency: skill.level,
                })) || [],
              skillsToLearn: userData.skillsToLearn || [],
              projects: userData.projects || [],
            };

            const edgeResponse = await fetch(
              "https://magicloops.dev/api/loop/8da68a4a-313f-47c4-a955-b7c4d7c946ec/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Accept: "application/json",
                },
                body: JSON.stringify(edgePayload),
              }
            );

            if (!edgeResponse.ok) {
              throw new Error(`HTTP error! status: ${edgeResponse.status}`);
            }

            const edgeResult = await edgeResponse.json();

            if (edgeResult) {
              userData.edgeAnalysisResult = edgeResult;
              displayEdgeAnalysisResults(edgeResult);
              saveToLocalStorage();

              $("#skills-section").hide();
              $("#edge-analysis-section").show();
              updateProgressIndicator(3);
            }
          } catch (error) {
            console.error("Error analyzing edge:", error);
            alert(
              "There was an error analyzing your edge. Please try again. Error: " +
                error.message
            );
          } finally {
            hideLoading();
          }
        });

        let skillsRadarChart = null;

        function createSkillsRadarChart(metrics) {
          const ctx = document
            .getElementById("skills-radar-chart")
            .getContext("2d");

          // Destroy existing chart if it exists
          if (skillsRadarChart) {
            skillsRadarChart.destroy();
          }

          // Format labels to be capitalized
          const formatLabel = (label) => {
            return label.charAt(0).toUpperCase() + label.slice(1);
          };

          // Ensure metrics are parsed as numbers
          const labels = Object.keys(metrics).map(formatLabel);
          const values = Object.values(metrics).map((value) =>
            parseFloat(value)
          );

          skillsRadarChart = new Chart(ctx, {
            type: "radar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Core Competencies",
                  data: values,
                  fill: true,
                  backgroundColor: "rgba(79, 70, 229, 0.2)",
                  borderColor: "rgb(79, 70, 229)",
                  pointBackgroundColor: "rgb(79, 70, 229)",
                  pointBorderColor: "#fff",
                  pointHoverBackgroundColor: "#fff",
                  pointHoverBorderColor: "rgb(79, 70, 229)",
                },
              ],
            },
            options: {
              elements: {
                line: {
                  borderWidth: 3,
                },
              },
              scales: {
                r: {
                  angleLines: {
                    display: true,
                  },
                  suggestedMin: 0,
                  suggestedMax: 5,
                  ticks: {
                    stepSize: 1,
                    callback: function (value) {
                      return value.toFixed(1);
                    },
                  },
                },
              },
              plugins: {
                legend: {
                  display: true,
                  position: "bottom",
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw.toFixed(1)}/5`;
                    },
                  },
                },
              },
            },
          });

          // Save metrics to localStorage
          userData.edgeAnalysisResult.metrics = metrics;
          saveToLocalStorage();
        }

        function displayEdgeAnalysisResults(edgeResult) {
          // Display summary
          $("#analysis-summary").text(edgeResult.summary);

          // Display strengths
          const strengthsList = $("#strengths-list");
          strengthsList.empty();
          edgeResult.strengths.forEach((strength) => {
            strengthsList.append(`
              <li class="list-group-item">
                <i class="fas fa-check-circle text-success me-2"></i>${strength}
              </li>
            `);
          });

          // Display growth areas
          const growthAreasContainer = $("#growth-areas-container");
          growthAreasContainer.empty();
          edgeResult.growth_areas.forEach((area) => {
            growthAreasContainer.append(`
              <div class="card growth-area-card">
                <div class="card-body">
                  <h6 class="card-title">${area.skill} (${area.category})</h6>
                  <p class="card-text">
                    <span class="badge bg-primary">Current Level: ${
                      area.current_level
                    }</span>
                    <span class="badge bg-${
                      area.recommended_focus.toLowerCase() === "high"
                        ? "danger"
                        : "warning"
                    }">
                      ${area.recommended_focus} Priority
                    </span>
                  </p>
                  <p class="card-text text-muted">${area.reason}</p>
                </div>
              </div>
            `);
          });

          // Display recommendations
          const recommendationsContainer = $("#recommendations-container");
          recommendationsContainer.empty();
          edgeResult.recommendations.forEach((rec) => {
            const nextStepsList = rec.next_steps
              .map(
                (step) =>
                  `<li class="list-group-item"><i class="fas fa-arrow-right me-2"></i>${step}</li>`
              )
              .join("");

            recommendationsContainer.append(`
              <div class="card recommendation-card">
                <div class="card-body">
                  <h6 class="card-title">
                    ${rec.title}
                    <span class="badge bg-${
                      rec.priority.toLowerCase() === "high"
                        ? "danger"
                        : "warning"
                    } ms-2">
                      ${rec.priority} Priority
                    </span>
                  </h6>
                  <p class="card-text">${rec.description}</p>
                  <h6 class="mt-3">Next Steps:</h6>
                  <ul class="list-group list-group-flush">
                    ${nextStepsList}
                  </ul>
                </div>
              </div>
            `);
          });

          // Create or update radar chart if metrics exist
          if (edgeResult.metrics) {
            createSkillsRadarChart(edgeResult.metrics);
          }
        }

        // Save functions
        function savePersonalInfo() {
          userData.personalInfo = {
            name: $("#name").val().trim(),
            age: $("#age").val().trim(),
            interests: [],
          };

          // Get interests
          $("#interests-container .tag").each(function () {
            const interest = $(this).text().trim().replace("Ã—", "");
            userData.personalInfo.interests.push(interest);
          });

          saveToLocalStorage();
        }

        function saveSkillsAndProjects() {
          // Skills already saved when rated

          // Save skills to learn
          userData.skillsToLearn = [];
          $("#skills-to-learn-container .tag").each(function () {
            const skill = $(this).text().trim().replace("Ã—", "");
            userData.skillsToLearn.push(skill);
          });

          // Save projects
          userData.projects = [];
          $(".project-description").each(function () {
            const project = $(this).val().trim();
            if (project) {
              userData.projects.push(project);
            }
          });

          saveToLocalStorage();
        }

        function saveToLocalStorage() {
          localStorage.setItem("edgeAnalysisData", JSON.stringify(userData));
        }

        // Load saved data
        function loadSavedData() {
          // Personal info
          if (userData.personalInfo) {
            $("#name").val(userData.personalInfo.name || "");
            $("#age").val(userData.personalInfo.age || "");

            if (userData.personalInfo.interests) {
              userData.personalInfo.interests.forEach((interest) => {
                addTag("interests-container", interest);
              });
            }
          }

          // Skills
          if (userData.skills) {
            userData.skills.forEach((skill) => {
              addSkill(skill.name);
              // Set skill level
              const skillLevel = $(`.skill-level[data-skill="${skill.name}"]`);
              if (skillLevel.length > 0 && skill.level) {
                skillLevel.find(".skill-level-circle").each(function () {
                  if ($(this).data("level") <= skill.level) {
                    $(this).addClass("filled");
                  }
                });
              }
            });
          }

          // Skills to learn
          if (userData.skillsToLearn) {
            userData.skillsToLearn.forEach((skill) => {
              addTag("skills-to-learn-container", skill);
            });
          }

          // Projects
          if (userData.projects) {
            $("#projects-list").empty();
            userData.projects.forEach((project) => {
              addProject(project);
            });
          }

          // Load edge analysis results if they exist
          // If edge analysis results exist, show them
          if (
            userData.edgeAnalysisResult &&
            Object.keys(userData.edgeAnalysisResult).length > 0
          ) {
            displayEdgeAnalysisResults(userData.edgeAnalysisResult);
          }

          // If we're on the project generation section, populate interests and strengths
          if ($("#project-generation-section").is(":visible")) {
            populateInterestsAndStrengths();
          }

          // Load saved PRDs if they exist
          if (userData.generatedPRDs) {
            // Add visual indicator for projects with saved PRDs
            Object.keys(userData.generatedPRDs).forEach((projectId) => {
              const prd = userData.generatedPRDs[projectId];
              $(`.project-card[data-project*="${prd.title}"]`)
                .addClass("has-prd")
                .find(".generate-prd")
                .html('<i class="fas fa-file-alt me-1"></i>View/Edit PRD');
            });
          }
        }

        // UI Helpers
        function showLoading(message) {
          $("#loading-text").text(message || "Processing...");
          $("#loading-overlay").addClass("active");
        }

        function hideLoading() {
          $("#loading-overlay").removeClass("active");
        }

        function showSuccessMessage(message) {
          $("#success-text").text(message);
          $("#success-message").addClass("show");

          setTimeout(() => {
            $("#success-message").removeClass("show");
          }, 3000);
        }

        function clearData() {
          localStorage.removeItem("edgeAnalysisData");
        }

        // Initialize all tooltips
        var tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Initialize project generation variables
        let savedProjects = [];
        if (localStorage.getItem("savedProjects")) {
          try {
            savedProjects = JSON.parse(localStorage.getItem("savedProjects"));
          } catch (e) {
            console.error("Error loading saved projects:", e);
          }
        }

        // Navigation handlers
        $(document).on("click", "#next-to-projects", function () {
          $("#edge-analysis-section").hide();
          $("#project-generation-section").show();
          updateProgressIndicator(4);
          populateInterestsAndStrengths();
        });

        // Add click handler for back-to-skills-from-edge button
        $(document).on("click", "#back-to-skills-from-edge", function () {
          $("#edge-analysis-section").hide();
          $("#skills-section").show();
          updateProgressIndicator(2);
        });

        function populateInterestsAndStrengths() {
          // Get interests from personal info
          const interests = userData.personalInfo.interests || [];
          console.log("Loading interests:", interests);
          const interestsHtml = interests
            .map(
              (interest) => `
            <div class="form-check">
                  <input class="form-check-input interest-checkbox" type="checkbox" value="${interest}" 
                    id="interest-${interest.replace(/\s+/g, "-")}" 
                    ${
                      (
                        userData.projectGenerationData?.selectedInterests || []
                      ).includes(interest)
                        ? "checked"
                        : ""
                    }>
                  <label class="form-check-label" for="interest-${interest.replace(
                    /\s+/g,
                    "-"
                  )}">
                ${interest}
              </label>
            </div>
          `
            )
            .join("");
          $("#interests-checkboxes").html(interestsHtml);

          // Get strengths from edge analysis
          const strengths = userData.edgeAnalysisResult?.strengths || [];
          console.log("Loading strengths:", strengths);
          const strengthsHtml = strengths
            .map(
              (strength) => `
            <div class="form-check">
                  <input class="form-check-input strength-checkbox" type="checkbox" value="${strength}" 
                    id="strength-${strength.replace(/\s+/g, "-")}"
                    ${
                      (
                        userData.projectGenerationData?.selectedStrengths || []
                      ).includes(strength)
                        ? "checked"
                        : ""
                    }>
                  <label class="form-check-label" for="strength-${strength.replace(
                    /\s+/g,
                    "-"
                  )}">
                ${strength}
              </label>
                </div>
              `
            )
            .join("");
          $("#strengths-checkboxes").html(strengthsHtml);

          // Populate observed problems
          const problems =
            userData.projectGenerationData.observedProblems || [];
          if (problems.length > 0) {
            const problemsHtml = problems
              .map(
                (problem) => `
              <div class="form-check d-flex justify-content-between align-items-center border-bottom py-2">
                <div>
                  <input class="form-check-input problem-checkbox" type="checkbox" value="${problem}" 
                    id="problem-${problem.replace(/\s+/g, "-")}" checked>
                  <label class="form-check-label" for="problem-${problem.replace(
                    /\s+/g,
                    "-"
                  )}">
                    ${problem}
                  </label>
                </div>
                <button class="btn btn-sm btn-outline-danger remove-problem" data-problem="${problem}">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `
              )
              .join("");
            $("#problems-list").html(problemsHtml);
          } else {
            $("#problems-list").html(
              '<p class="text-muted">No problems added yet. Add your first observed problem above!</p>'
            );
          }

          // Set selected project goal if exists
          if (userData.projectGenerationData?.projectGoal) {
            $("#project-goal").val(userData.projectGenerationData.projectGoal);
            // Trigger change to show description
            $("#project-goal").trigger("change");
          }

          // If we have saved project ideas, display them
          if (userData.projectGenerationData?.generatedIdeas?.length > 0) {
            displayProjectIdeas(userData.projectGenerationData.generatedIdeas);
          }

          // Display saved projects
          displaySavedProjects();
        }

        $("#generate-projects-btn").click(async function () {
          const selectedInterests = $(".interest-checkbox:checked")
            .map(function () {
              return $(this).val();
            })
            .get();

          const selectedStrengths = $(".strength-checkbox:checked")
            .map(function () {
              return $(this).val();
            })
            .get();

          const selectedProblems = $(".problem-checkbox:checked")
            .map(function () {
              return $(this).val();
            })
            .get();

          const projectGoal = $("#project-goal").val();

          if (!projectGoal) {
            alert("Please select a project goal before generating ideas.");
            return;
          }

          if (
            selectedInterests.length === 0 ||
            selectedStrengths.length === 0
          ) {
            alert("Please select at least one interest and one strength.");
            return;
          }

          try {
            showLoading("Generating project ideas...");

            const response = await fetch(
              "https://magicloops.dev/api/loop/950477ef-525f-4944-83d6-9a1bbdf858a3/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  interests: selectedInterests.join(", "),
                  strengths: selectedStrengths.join(", "),
                  observedProblems: selectedProblems,
                  projectGoal: projectGoal,
                  username: $("#name").val() || "Anonymous User", // Added username
                }),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to generate project ideas");
            }

            const result = await response.json();

            // Save project generation data
            userData.projectGenerationData = {
              ...userData.projectGenerationData,
              selectedInterests,
              selectedStrengths,
              selectedProblems,
              generatedIdeas: result.ideas,
              howMightWe: result.how_might_we,
            };
            saveToLocalStorage();

            // Display the "How Might We" statement
            $("#how-might-we-text").text(result.how_might_we);
            $("#how-might-we-section").show();

            displayProjectIdeas(result.ideas);
          } catch (error) {
            console.error("Error generating project ideas:", error);
            alert("Failed to generate project ideas. Please try again.");
          } finally {
            hideLoading();
          }
        });

        function displayProjectIdeas(ideas) {
          const projectsHtml = ideas
            .map(
              (idea, index) => `
            <div class="col-md-4 mb-4">
              <div class="card h-100 project-card" data-project='${JSON.stringify(
                idea
              )}'>
                <div class="card-header bg-primary text-white">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>${idea.title}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">${idea.description}</p>
                  <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm generate-prd">
                      <i class="fas fa-file-alt me-1"></i>Generate PRD
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `
            )
            .join("");

          $("#project-ideas-container").html(projectsHtml);

          // If we have a saved how_might_we statement, display it
          if (userData.projectGenerationData.howMightWe) {
            $("#how-might-we-text").text(
              userData.projectGenerationData.howMightWe
            );
            $("#how-might-we-section").show();
          }
        }

        function toggleProjectPin(btn) {
          const card = $(btn).closest(".project-card");
          const project = JSON.parse(card.attr("data-project"));

          if ($(btn).hasClass("pinned")) {
            // Unpin project
            $(btn).removeClass("pinned");
            card.removeClass("saved");
            savedProjects = savedProjects.filter(
              (p) => p.title !== project.title
            );
          } else {
            // Pin project
            $(btn).addClass("pinned");
            card.addClass("saved");
            if (!savedProjects.some((p) => p.title === project.title)) {
              savedProjects.push(project);
            }
          }

          // Save to localStorage
          localStorage.setItem("savedProjects", JSON.stringify(savedProjects));
          displaySavedProjects();
        }

        function displaySavedProjects() {
          if (savedProjects.length === 0) {
            $("#saved-projects-section").hide();
            return;
          }

          const savedProjectsHtml = savedProjects
            .map(
              (project) => `
            <div class="col-md-4 mb-4">
              <div class="card h-100 project-card saved">
                <button class="btn btn-link pin-btn pinned" onclick="toggleProjectPin(this)">
                  <i class="fas fa-thumbtack"></i>
                </button>
                <div class="card-body">
                  <h5 class="card-title">${project.title}</h5>
                  <p class="card-text">${project.description}</p>
                  
                  <div class="mentor-section">
                    <div class="mentor-header">
                      <img src="${project.mentor.image_url}" 
                           alt="${project.mentor.name}" 
                           class="mentor-image"
                           onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(
                             project.mentor.name
                           )}&background=4f46e5&color=fff'">
                      <div>
                        <h6 class="mentor-name">${project.mentor.name}</h6>
                        <small class="text-muted">Project Mentor</small>
                      </div>
                    </div>
                    <p class="mentor-bio">${project.mentor.bio}</p>
                  </div>
                </div>
              </div>
            </div>
          `
            )
            .join("");

          $("#saved-projects-container").html(savedProjectsHtml);
          $("#saved-projects-section").show();
        }

        // Handle adding new interest
        $("#add-new-interest-btn").click(function () {
          const newInterest = $("#new-interest-input").val().trim();
          if (newInterest) {
            addNewInterest(newInterest);
            $("#new-interest-input").val("");
          }
        });

        // Handle enter key for interest input
        $("#new-interest-input").keypress(function (e) {
          if (e.which === 13) {
            const newInterest = $(this).val().trim();
            if (newInterest) {
              addNewInterest(newInterest);
              $(this).val("");
            }
          }
        });

        // Handle adding new strength
        $("#add-new-strength-btn").click(function () {
          const newStrength = $("#new-strength-input").val().trim();
          if (newStrength) {
            addNewStrength(newStrength);
            $("#new-strength-input").val("");
          }
        });

        // Handle enter key for strength input
        $("#new-strength-input").keypress(function (e) {
          if (e.which === 13) {
            const newStrength = $(this).val().trim();
            if (newStrength) {
              addNewStrength(newStrength);
              $(this).val("");
            }
          }
        });

        function addNewInterest(interest) {
          // Add to personal info interests if not already there
          if (!userData.personalInfo.interests) {
            userData.personalInfo.interests = [];
          }
          if (!userData.personalInfo.interests.includes(interest)) {
            userData.personalInfo.interests.push(interest);

            // Add to interests container in personal info section
            addTag("interests-container", interest);

            // Add to project generation section
            const interestHtml = `
              <div class="form-check">
                <input class="form-check-input interest-checkbox" type="checkbox" value="${interest}" 
                  id="interest-${interest.replace(/\s+/g, "-")}" checked>
                <label class="form-check-label" for="interest-${interest.replace(
                  /\s+/g,
                  "-"
                )}">
                  ${interest}
                </label>
              </div>
            `;
            $("#interests-checkboxes").append(interestHtml);

            // Update selected interests
            if (!userData.projectGenerationData.selectedInterests) {
              userData.projectGenerationData.selectedInterests = [];
            }
            userData.projectGenerationData.selectedInterests.push(interest);

            // Save to localStorage
            saveToLocalStorage();

            showSuccessMessage(`Added new interest: ${interest}`);
          } else {
            alert("This interest already exists!");
          }
        }

        function addNewStrength(strength) {
          // Add to edge analysis strengths if not already there
          if (!userData.edgeAnalysisResult.strengths) {
            userData.edgeAnalysisResult.strengths = [];
          }
          if (!userData.edgeAnalysisResult.strengths.includes(strength)) {
            userData.edgeAnalysisResult.strengths.push(strength);

            // Add to project generation section
            const strengthHtml = `
              <div class="form-check">
                <input class="form-check-input strength-checkbox" type="checkbox" value="${strength}" 
                  id="strength-${strength.replace(/\s+/g, "-")}" checked>
                <label class="form-check-label" for="strength-${strength.replace(
                  /\s+/g,
                  "-"
                )}">
                  ${strength}
                </label>
              </div>
            `;
            $("#strengths-checkboxes").append(strengthHtml);

            // Update selected strengths
            if (!userData.projectGenerationData.selectedStrengths) {
              userData.projectGenerationData.selectedStrengths = [];
            }
            userData.projectGenerationData.selectedStrengths.push(strength);

            // Save to localStorage
            saveToLocalStorage();

            showSuccessMessage(`Added new strength: ${strength}`);
          } else {
            alert("This strength already exists!");
          }
        }

        // Handle adding new problem
        $("#add-new-problem-btn").click(function () {
          const newProblem = $("#new-problem-input").val().trim();
          if (newProblem) {
            addNewProblem(newProblem);
            $("#new-problem-input").val("");
          }
        });

        // Handle enter key for problem input
        $("#new-problem-input").keypress(function (e) {
          if (e.which === 13) {
            const newProblem = $(this).val().trim();
            if (newProblem) {
              addNewProblem(newProblem);
              $(this).val("");
            }
          }
        });

        // Handle project goal selection
        $("#project-goal").change(function () {
          const selectedGoal = $(this).val();
          userData.projectGenerationData.projectGoal = selectedGoal;
          saveToLocalStorage();

          // Update goal description
          const descriptions = {
            ai_research:
              "Focus on advancing AI technologies through academic research and innovation. Ideal for those interested in pushing the boundaries of AI capabilities.",
            ai_entrepreneurship:
              "Create innovative business solutions using AI technology. Perfect for those who want to solve market problems and build sustainable businesses.",
            social_impact:
              "Leverage AI to address social challenges and create positive change. Great for those passionate about making a difference in society.",
          };

          $("#goal-description").text(descriptions[selectedGoal] || "");
        });

        function addNewProblem(problem) {
          if (!userData.projectGenerationData.observedProblems) {
            userData.projectGenerationData.observedProblems = [];
          }

          if (
            !userData.projectGenerationData.observedProblems.includes(problem)
          ) {
            userData.projectGenerationData.observedProblems.push(problem);

            // Add to problems list
            const problemHtml = `
              <div class="form-check d-flex justify-content-between align-items-center border-bottom py-2">
                <div>
                  <input class="form-check-input problem-checkbox" type="checkbox" value="${problem}" 
                    id="problem-${problem.replace(/\s+/g, "-")}" checked>
                  <label class="form-check-label" for="problem-${problem.replace(
                    /\s+/g,
                    "-"
                  )}">
                    ${problem}
                  </label>
                </div>
                <button class="btn btn-sm btn-outline-danger remove-problem" data-problem="${problem}">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
            $("#problems-list").append(problemHtml);

            // Save to localStorage
            saveToLocalStorage();

            showSuccessMessage(`Added new problem: ${problem}`);
          } else {
            alert("This problem has already been added!");
          }
        }

        // Handle removing problems
        $(document).on("click", ".remove-problem", function () {
          const problem = $(this).data("problem");
          userData.projectGenerationData.observedProblems =
            userData.projectGenerationData.observedProblems.filter(
              (p) => p !== problem
            );
          $(this).closest(".form-check").remove();

          // Show empty state message if no problems left
          if (userData.projectGenerationData.observedProblems.length === 0) {
            $("#problems-list").html(
              '<p class="text-muted">No problems added yet. Add your first observed problem above!</p>'
            );
          }

          saveToLocalStorage();
        });

        // Add handler for problem checkboxes
        $(document).on("change", ".problem-checkbox", function () {
          const problem = $(this).val();
          if (!userData.projectGenerationData.selectedProblems) {
            userData.projectGenerationData.selectedProblems = [];
          }

          if (this.checked) {
            if (
              !userData.projectGenerationData.selectedProblems.includes(problem)
            ) {
              userData.projectGenerationData.selectedProblems.push(problem);
            }
          } else {
            userData.projectGenerationData.selectedProblems =
              userData.projectGenerationData.selectedProblems.filter(
                (p) => p !== problem
              );
          }

          saveToLocalStorage();
        });

        // Initialize userData with default values
        if (!userData.projectGenerationData) {
          userData.projectGenerationData = {
            selectedInterests: [],
            selectedStrengths: [],
            selectedProblems: [],
            observedProblems: [],
            projectGoal: "",
            generatedIdeas: [],
            howMightWe: "",
          };
        }

        // Add click handler for next-to-skills button
        $("#next-to-skills").click(function () {
          savePersonalInfo();
          $("#personal-info-section").hide();
          $("#skills-section").show();
          updateProgressIndicator(2);
        });

        // Initialize PRD Modal
        const prdModal = new bootstrap.Modal(
          document.getElementById("prd-modal")
        );
        let isEditingPRD = false;

        // Add click handler for generate PRD button
        $(document).on("click", ".generate-prd", function () {
          const card = $(this).closest(".project-card");
          const project = JSON.parse(card.attr("data-project"));
          const projectId = project.title.replace(/\s+/g, "_").toLowerCase(); // Create unique ID for the project

          // Check if we have a saved PRD for this project
          if (userData.generatedPRDs && userData.generatedPRDs[projectId]) {
            const savedPRD = userData.generatedPRDs[projectId];

            // Populate modal with saved data
            $("#prd-idea-title").val(savedPRD.title);
            $("#prd-idea-description").val(savedPRD.description);
            $("#prd-conversation")
              .val(savedPRD.conversation)
              .prop("disabled", false);
            $("#generate-prd-btn").prop("disabled", false);

            // Show the saved PRD content
            $(".prd-content").html(savedPRD.prdHtml);
            $("#prd-result").show();
          } else {
            // Populate modal with project details for new PRD
            $("#prd-idea-title").val(project.title);
            $("#prd-idea-description").val(project.description);
            $("#prd-conversation").val("").prop("disabled", false);
            $("#generate-prd-btn").prop("disabled", false);
            $("#prd-result").hide();
            $(".prd-content").empty();
          }

          prdModal.show();
        });

        // Add click handler for generate PRD button in modal
        $("#generate-prd-btn").click(async function () {
          const button = $(this);
          const originalText = button.html();
          button
            .html('<i class="fas fa-spinner fa-spin me-2"></i>Generating...')
            .prop("disabled", true);
          $("#prd-conversation").prop("disabled", true);

          try {
            const payload = {
              title: $("#prd-idea-title").val().trim(),
              description: $("#prd-idea-description").val().trim(),
              conversation: $("#prd-conversation").val().trim(),
              userName: $("#name").val() || "Anonymous User",
            };

            // Validate required fields
            if (!payload.title || !payload.description) {
              throw new Error("Please provide both idea title and description");
            }

            const response = await fetch(
              "https://magicloops.dev/api/loop/5d5e924f-39c2-4c90-abf8-7357ee7b3820/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to generate PRD");
            }

            const result = await response.json();

            // Format the PRD content
            const prdHtml = `
              <div class="prd-section mb-4">
                <h6 class="text-primary"><i class="fas fa-info-circle me-2"></i>Title/Overview</h6>
                <div class="prd-editable">${result["Title/Overview"]}</div>
              </div>

              <div class="prd-section mb-4">
                <h6 class="text-primary"><i class="fas fa-bullseye me-2"></i>Goals/Objectives</h6>
                <div class="prd-editable">${result["Goals/Objectives"]}</div>
              </div>

              <div class="prd-section mb-4">
                <h6 class="text-primary"><i class="fas fa-user me-2"></i>User Stories</h6>
                <ul class="list-unstyled prd-editable">
                  ${result["User Stories"]
                    .map(
                      (story) => `
                    <li><i class="fas fa-check-circle text-success me-2"></i>${story}</li>
                  `
                    )
                    .join("")}
                </ul>
              </div>

              <div class="prd-section">
                <h6 class="text-primary"><i class="fas fa-list-check me-2"></i>Functional Requirements</h6>
                <div class="ms-3">
                  <h6 class="text-success mb-2">Must Have:</h6>
                  <ul class="list-unstyled mb-3 prd-editable">
                    ${result["Functional Requirements"]["Must Have"]
                      .map(
                        (req) => `
                      <li><i class="fas fa-check me-2"></i>${req}</li>
                    `
                      )
                      .join("")}
                  </ul>

                  <h6 class="text-warning mb-2">Nice to Have:</h6>
                  <ul class="list-unstyled prd-editable">
                    ${result["Functional Requirements"]["Nice to Have"]
                      .map(
                        (req) => `
                      <li><i class="fas fa-star me-2"></i>${req}</li>
                    `
                      )
                      .join("")}
                  </ul>
                </div>
              </div>
            `;

            $(".prd-content").html(prdHtml);
            $("#prd-result").show();

            // Save the generated PRD to userData
            const projectId = payload.title.replace(/\s+/g, "_").toLowerCase();
            if (!userData.generatedPRDs) {
              userData.generatedPRDs = {};
            }
            userData.generatedPRDs[projectId] = {
              title: payload.title,
              description: payload.description,
              conversation: payload.conversation,
              prdHtml: prdHtml,
              result: result, // Store the raw result too
              timestamp: new Date().toISOString(),
            };

            // Save to localStorage
            saveToLocalStorage();

            // Initialize tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();

            showSuccessMessage("PRD generated and saved!");
          } catch (error) {
            console.error("Error generating PRD:", error);
            alert(error.message || "Failed to generate PRD. Please try again.");
          } finally {
            button.html(originalText).prop("disabled", false);
            $("#prd-conversation").prop("disabled", false);
          }
        });

        // Add click handler for edit PRD button
        $("#edit-prd-btn").click(function () {
          const button = $(this);
          const prdContent = $(".prd-content");
          const isEditing = prdContent.hasClass("editing");

          if (isEditing) {
            // Save changes
            button.html('<i class="fas fa-edit me-1"></i>Edit');
            button
              .removeClass("btn-outline-success")
              .addClass("btn-outline-secondary");
            prdContent.removeClass("editing");
            prdContent.find(".prd-editable").removeAttr("contenteditable");

            // Save the edited PRD content
            const projectId = $("#prd-idea-title")
              .val()
              .trim()
              .replace(/\s+/g, "_")
              .toLowerCase();
            if (userData.generatedPRDs && userData.generatedPRDs[projectId]) {
              userData.generatedPRDs[projectId].prdHtml =
                $(".prd-content").html();
              saveToLocalStorage();
            }

            showSuccessMessage("PRD changes saved!");
          } else {
            // Enable editing
            button.html('<i class="fas fa-save me-1"></i>Save');
            button
              .removeClass("btn-outline-secondary")
              .addClass("btn-outline-success");
            prdContent.addClass("editing");
            prdContent.find(".prd-editable").attr("contenteditable", "true");
          }
        });

        // Add click handler for copy PRD button
        $("#copy-prd-btn").click(function () {
          const formatSection = (title, content) =>
            `${title}\n${"=".repeat(title.length)}\n${content}\n\n`;

          const prdContent = [
            {
              title: "Title/Overview",
              content: $(".prd-section:nth(0) .prd-editable").text().trim(),
            },
            {
              title: "Goals/Objectives",
              content: $(".prd-section:nth(1) .prd-editable").text().trim(),
            },
            {
              title: "User Stories",
              content: Array.from($(".prd-section:nth(2) .prd-editable li"))
                .map((li, i) => `${i + 1}. ${$(li).text().trim()}`)
                .join("\n"),
            },
            {
              title: "Functional Requirements",
              content: [
                "Must Have:",
                ...Array.from($(".prd-section:nth(3) .prd-editable li"))
                  .slice(0, -2)
                  .map((li, i) => `${i + 1}. ${$(li).text().trim()}`),
                "\nNice to Have:",
                ...Array.from($(".prd-section:nth(3) .prd-editable li"))
                  .slice(-2)
                  .map((li, i) => `${i + 1}. ${$(li).text().trim()}`),
              ].join("\n"),
            },
          ]
            .map((section) => formatSection(section.title, section.content))
            .join("");

          navigator.clipboard
            .writeText(prdContent)
            .then(() => showSuccessMessage("PRD copied to clipboard!"))
            .catch((err) => {
              console.error("Failed to copy PRD:", err);
              alert("Failed to copy PRD to clipboard");
            });
        });

        // Add navigation to Future Plans
        $(document).on("click", "#next-to-future-plans", function () {
          $("#edge-analysis-section").hide();
          $("#project-generation-section").hide();
          $("#future-plans-section").show();
          updateProgressIndicator(5);
          loadSavedPRDs();
        });

        // Function to load saved PRDs into the selection list
        function loadSavedPRDs() {
          const savedPRDsList = $("#saved-prds-list");
          savedPRDsList.empty();

          // Load userData from localStorage if needed
          if (
            !userData.generatedPRDs &&
            localStorage.getItem("edgeAnalysisData")
          ) {
            try {
              userData = JSON.parse(localStorage.getItem("edgeAnalysisData"));
            } catch (e) {
              console.error("Error loading saved data:", e);
            }
          }

          if (
            userData.generatedPRDs &&
            Object.keys(userData.generatedPRDs).length > 0
          ) {
            Object.entries(userData.generatedPRDs).forEach(
              ([projectId, prd]) => {
                const hasPlan =
                  userData.projectPlans && userData.projectPlans[projectId];
                savedPRDsList.append(`
                <div class="list-group-item list-group-item-action prd-item" 
                     data-project-id="${projectId}" 
                     style="cursor: pointer;">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">${prd.title}</h6>
                      <p class="mb-1 text-muted small">${prd.description.substring(
                        0,
                        100
                      )}...</p>
                    </div>
                    ${
                      hasPlan
                        ? '<span class="badge bg-success">Plan Created</span>'
                        : ""
                    }
                  </div>
                </div>
              `);

                // If this PRD has a plan, show it if it was the last selected one
                if (
                  hasPlan &&
                  localStorage.getItem("lastSelectedPRD") === projectId
                ) {
                  setTimeout(() => {
                    $(`.prd-item[data-project-id="${projectId}"]`).click();
                  }, 100);
                }
              }
            );

            // Add click handler for PRD selection
            $(".prd-item").on("click", function () {
              const projectId = $(this).data("project-id");
              $(".prd-item").removeClass("active");
              $(this).addClass("active");
              localStorage.setItem("lastSelectedPRD", projectId);
              selectPRD(projectId);
            });
          } else {
            savedPRDsList.html(`
              <div class="text-center py-4">
                <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                <p class="text-muted">No saved PRDs found. Generate a PRD first in the Project Generation section.</p>
                <button class="btn btn-primary" id="go-to-project-generation">
                  <i class="fas fa-arrow-left me-2"></i>Go to Project Generation
                </button>
              </div>
            `);
          }
        }

        // Function to handle PRD selection
        function selectPRD(projectId) {
          const prd = userData.generatedPRDs[projectId];
          if (!prd) return;

          $("#selected-prd-title").text(prd.title);
          $("#selected-prd-description").text(prd.description);
          $("#selected-prd-details").show();
          $("#generate-plan-btn").data("project-id", projectId);

          if (userData.projectPlans && userData.projectPlans[projectId]) {
            displayProjectPlan(userData.projectPlans[projectId]);
            $("#plan-result").show();
          } else {
            $("#plan-result").hide();
          }
        }

        // Add this to the document ready function
        // Check if we should show the future plans section based on URL hash
        if (window.location.hash === "#future-plans") {
          $(".form-section").hide();
          $("#future-plans-section").show();
          updateProgressIndicator(5);
          loadSavedPRDs();
        }

        // Add click handler for progress step 5 (Future Plans)
        $("#step5").click(function () {
          $(".form-section").hide();
          $("#future-plans-section").show();
          updateProgressIndicator(5);
          loadSavedPRDs();
        });

        // Add back button handler
        $("#back-to-projects-from-plans").click(function () {
          $("#future-plans-section").hide();
          $("#project-generation-section").show();
          updateProgressIndicator(4);
        });

        // Add click handler for generate plan button
        $(document).on("click", "#generate-plan-btn", async function () {
          const projectId = $(".prd-item.active").data("project-id");
          if (!projectId) {
            alert("Please select a project first");
            return;
          }

          const prd = userData.generatedPRDs[projectId];
          if (!prd) {
            alert("Selected project not found");
            return;
          }

          const button = $(this);
          const originalText = button.html();
          button
            .html(
              '<i class="fas fa-spinner fa-spin me-2"></i>Generating Plan...'
            )
            .prop("disabled", true);

          try {
            const response = await fetch(
              "https://magicloops.dev/api/loop/3789ff0c-f523-4de9-813f-816d9294031a/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  projectTitle: prd.title,
                  projectIdea: prd.description,
                  interests: userData.personalInfo.interests.join(", "),
                  username: $("#name").val() || "Anonymous User", // Added username
                }),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to generate project plan");
            }

            const result = await response.json();

            if (!userData.projectPlans) {
              userData.projectPlans = {};
            }
            userData.projectPlans[projectId] = result;
            saveToLocalStorage();

            displayProjectPlan(result);

            // Update badge
            const listItem = $(`.prd-item[data-project-id="${projectId}"]`);
            if (!listItem.find(".badge").length) {
              listItem
                .find(".d-flex")
                .append('<span class="badge bg-success">Plan Created</span>');
            }

            showSuccessMessage("10-week plan generated successfully!");
          } catch (error) {
            console.error("Error generating plan:", error);
            alert("Failed to generate project plan. Please try again.");
          } finally {
            button.html(originalText).prop("disabled", false);
          }
        });

        // Function to display the project plan
        function displayProjectPlan(plan) {
          const container = $("#week-plan-container");
          container.empty();

          plan["10WeekPlan"].forEach((week, index) => {
            const weekCard = $(`
              <div class="week-card card">
                <div class="card-body">
                  <h5 class="card-title">Week ${week.week}: ${week.focus}</h5>
                  <ul class="step-list">
                    ${week.steps.map((step) => `<li>${step}</li>`).join("")}
                  </ul>
                  <div class="milestone-badge">
                    <i class="fas fa-flag-checkered me-2"></i>Milestone: ${
                      week.milestone
                    }
                  </div>
                </div>
              </div>
            `);
            container.append(weekCard);
          });

          $("#plan-result").show();
        }

        // Add save plan button handler
        $("#save-plan-btn").click(function () {
          const projectId = $(".prd-item.active").data("project-id");
          if (userData.projectPlans[projectId]) {
            // Convert plan to PDF or other format if needed
            showSuccessMessage("Plan saved successfully!");
          }
        });

        // Add click handler for next-to-project-generation button
        $(document).on("click", "#next-to-project-generation", function () {
          $("#edge-analysis-section").hide();
          $("#project-generation-section").show();
          updateProgressIndicator(4);
          populateInterestsAndStrengths();
        });
      });
    </script>
  </body>
</html>
